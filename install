#! /bin/bash

echo "    **************************************"
echo "  ****   Proca-dotfiles: Installation   ****"
echo "**********************************************"

DOTFILES_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
SUB_DIRS="runcom"

echo "[INFO]  Creating symlinks in home directory for *rc files..."
for SUB in $SUB_DIRS; do
  for DOTFILE in `find $DOTFILES_DIR/$SUB -type f`; do
    
    FILE_NAME=`basename $DOTFILE`
    
    # Create backups
    if [ -f ~/$FILE_NAME ]; then
      echo "[INFO]  Creating backup for existing $FILE_NAME file..."
      cat ~/$FILE_NAME > ~/$FILE_NAME.bak
    fi

    # Create symlink 
    ln -sfv "$DOTFILE" ~

  done
done

echo "[INFO] Symlinking the dotfiles directory from home directory..."
ln -sfv "$DOTFILES_DIR" ~

if [ ! -f ~/.vim/autoload/plug.vim ]; then
  echo "Shall I install vim-plug for plugin management? [y/n] "
  read res
  if [ "$res" == "y" ]; then 
    echo "[INFO]  Installing vim-plug for plugin management."
    echo "[INFO]  Open vim and run :PlugInstall to install all."
    curl -fLo ~/.vim/autoload/plug.vim --create-dirs \
      https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim
  fi
fi

echo "[INFO] Enabling new configuration..."
source ~/.bashrc

echo "[INFO]  Done."

exit $?
